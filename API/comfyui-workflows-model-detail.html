<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComfyUI工作流模型详情 - RunningHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="model-detail.css?v=20251050">
    <style>
        /* 确保标签可见的样式 */
        .model-tag.show-tag {
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        .model-tag.hide-tag {
            display: none !important;
        }
    </style>
</head>
<body class="model-detail-page">
    <!-- 顶部导航 -->
    <header class="detail-header">
        <div class="container">
            <div class="brand">
                <span class="logo-icon">R</span>
                <span class="brand-name">RunningHUB</span>
            </div>
            <div class="header-actions">
                <div class="dropdown-wrapper">
                    <button class="btn small dropdown-btn" data-dropdown="sdk">
                        其他SDK下载
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="sdk-dropdown">
                        <a href="https://github.com/HM-RunningHub" target="_blank" class="dropdown-item">Github</a>
                        <a href="https://github.com/HM-RunningHub/RH_CozeSDK" target="_blank" class="dropdown-item">Coze SDK</a>
                        <a href="https://github.com/HM-RunningHub/ComfyUI_RH_APICall" target="_blank" class="dropdown-item">ComfyUI插件</a>
                        <a href="https://github.com/zombieyang/sd-ppp" target="_blank" class="dropdown-item">SD-PPP</a>
                    </div>
                </div>
                <div class="dropdown-wrapper">
                    <button class="btn small dropdown-btn" data-dropdown="docs">
                        文档中心
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="docs-dropdown">
                        <a href="https://s.apifox.cn/b860476a-b4d0-4aa5-91b8-6dcaa18d6c7d" target="_blank" class="dropdown-item">API文档</a>
                        <a href="https://runninghub.feishu.cn/wiki/PdmcwScGMiXiuWk5PqhcD7LznYr" target="_blank" class="dropdown-item">三方API调用说明</a>
                    </div>
                </div>
                <button class="btn primary small">
                    进入控制台
                    <i class="fas fa-arrow-right"></i>
                </button>
                <div class="header-icons">
                    <button class="detail-nav-btn" title="联系">
                        <i class="fas fa-headset"></i>
                    </button>
                    <button class="detail-nav-btn" title="通知">
                        <i class="fas fa-bell"></i>
                    </button>
                    <button class="detail-nav-btn" title="黄钻">
                        <i class="fas fa-gem"></i>
                    </button>
                    <button class="detail-nav-btn" title="用户中心">
                        <i class="fas fa-user-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 面包屑与标题 -->
    <section class="detail-hero">
        <div class="container hero-inner">
            <div class="hero-content-wrapper">
                <!-- 左边部分 -->
                <div class="hero-left">
                    <!-- 第一行：标题 + 复制按钮 -->
                    <div class="model-title-row">
                        <h1 id="modelTitle" class="model-title">工作流名称</h1>
                        <button class="icon-btn copy-btn" id="copyModelNameBtn" title="复制工作流名称">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <!-- 第二行：工作流简介 -->
                    <p class="model-description" id="modelDescription">工作流简介</p>
                    <!-- 第三行：标签 -->
                    <div class="model-tag-row" id="modelTagRow">
                        <span class="model-tag" id="thirdPartyTag">三方模型API</span>
                        <span class="model-tag" id="ownModelTag">自有模型API</span>
                    </div>
                    <!-- 第四行：运行数、喜欢数、收藏数 -->
                    <div class="model-stats-row">
                        <span class="stat-item">
                            <i class="fas fa-play-circle"></i>
                            <span id="runCountDisplay">0</span>
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-heart"></i>
                            <span id="likeCountDisplay">0</span>
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-star"></i>
                            <span id="favoriteCountDisplay">0</span>
                        </span>
                    </div>
                    <!-- 第五行：API、Playground导航按钮 -->
                    <div class="hero-tabs">
                        <button class="tab active" data-target="#apiPane">API</button>
                        <button class="tab" data-target="#playgroundPane" data-link="playground">Playground</button>
                    </div>
                </div>

                <!-- 右边部分：API KEY对比表格 -->
                <div class="hero-right">
                    <div class="api-key-table-wrapper">
                        <h3 class="table-title">价格和权益</h3>
                        <!-- 表格1：同时显示三方模型API和自有模型API -->
                        <table class="api-key-table" id="bothModelTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>类型</th>
                                    <th>消费级-会员API KEY</th>
                                    <th>企业级-共享API KEY</th>
                                    <th>企业级-独占API KEY</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>三方API调用费用</strong></td>
                                    <td id="bothThirdPartyPrice1">¥XX/次</td>
                                    <td id="bothThirdPartyPrice2">¥XX/次</td>
                                    <td id="bothThirdPartyPrice3">¥XX/次</td>
                                </tr>
                                <tr>
                                    <td><strong>运行时长消耗费用</strong></td>
                                    <td>标准任务（24G显存）：每秒消耗0.2个RH币；<br>Plus任务（48G显存）：每秒消耗0.4个RH币</td>
                                    <td>标准运行（24G）￥4/小时，按秒计费；<br>Plus运行（48G）￥6/小时，按秒计费</td>
                                    <td>租期内免费</td>
                                </tr>
                                <tr>
                                    <td><strong>计费模式</strong></td>
                                    <td>三方API调用费用，消耗钱包余额；<br>运行时长消耗费用，消耗RH币</td>
                                    <td>三方API调用费用+运行时长消耗费用，消耗钱包余额</td>
                                    <td>三方API调用费用，消耗钱包余额</td>
                                </tr>
                                <tr>
                                    <td><strong>API并发数</strong></td>
                                    <td>基础版会员：1；基础版Plus会员：1；专业版会员：3；专业版Plus会员：5</td>
                                    <td>默认50，<br>如需扩大并发数请联系：jason@runninghub.ai</td>
                                    <td>任务并发数等同于购买GPU数量</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- 表格2：只显示自有模型API -->
                        <table class="api-key-table" id="ownModelOnlyTable">
                            <thead>
                                <tr>
                                    <th>类型</th>
                                    <th>消费级-会员API KEY</th>
                                    <th>企业级-共享API KEY</th>
                                    <th>企业级-独占API KEY</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>运行时长消耗费用</strong></td>
                                    <td>标准任务（24G显存）：每秒消耗0.2个RH币；<br>Plus任务（48G显存）：每秒消耗0.4个RH币</td>
                                    <td>标准运行（24G）￥4/小时，按秒计费；<br>Plus运行（48G）￥6/小时，按秒计费</td>
                                    <td>租期内免费</td>
                                </tr>
                                <tr>
                                    <td><strong>计费模式</strong></td>
                                    <td>消耗RH币</td>
                                    <td>消耗钱包余额</td>
                                    <td>租期内免费</td>
                                </tr>
                                <tr>
                                    <td><strong>API并发数</strong></td>
                                    <td>基础版会员：1；基础版Plus会员：1；专业版会员：3；专业版Plus会员：5</td>
                                    <td>默认50，<br>如需扩大并发数请联系：jason@runninghub.ai</td>
                                    <td>任务并发数等同于购买GPU数量</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- 更多内容链接 -->
                        <div class="comparison-link-wrapper">
                            <span class="comparison-text">更多内容见</span>
                            <button class="comparison-btn" id="comparisonLinkBtn">API KEY类型及权益对比</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 主体内容：三个面板同页切换 -->
    <main class="detail-main container">
        <!-- API 文档 -->
        <section id="apiPane" class="pane active" aria-labelledby="API">
            <div class="api-layout">
                <aside class="api-nav">
                    <div class="nav-cap">目录</div>
                    <ul>
                        <li class="active">1. 调用API</li>
                        <li>2. 身份验证</li>
                        <li>3. 队列</li>
                        <li>4. 文件</li>
                        <li>5. 数据结构</li>
                    </ul>
                </aside>
                <div class="api-content">
                    <article class="doc-block">
                        <h3>About</h3>
                        <p id="aboutText">基于ComfyUI工作流的示例说明。</p>
                    </article>
                    <article class="doc-block">
                        <h3>1. 调用 API（JavaScript / Node.js）</h3>
<pre class="code"><code id="codeSample">npm install --save @fal-ai/client

import { fal } from "@fal-ai/client";

const result = await fal.subscribe("comfyui-workflow-endpoint", {
  input: {
    workflow_id: "your-workflow-id",
    parameters: {
      "prompt": "您的输入内容"
    }
  },
  logs: true,
  onQueueUpdate: (update) => {
    if (update.status === "IN_PROGRESS") {
      update.logs.map(l => l.message).forEach(console.log);
    }
  },
});
console.log(result.data);
console.log(result.requestId);</code></pre>
                        <p>更多详情参考官方文档。</p>
                    </article>
                    <article class="doc-block">
                        <h3>2. 队列与文件</h3>
<pre class="code"><code>// 提交到队列
import { fal } from "@fal-ai/client";
const { request_id } = await fal.queue.submit("comfyui-workflow-endpoint", { 
  input: {
    workflow_id: "your-workflow-id",
    parameters: {/* 工作流参数 */}
  }
});

// 轮询状态
const status = await fal.queue.status("comfyui-workflow-endpoint", { requestId: request_id, logs: true });

// 获取结果
const result = await fal.queue.result("comfyui-workflow-endpoint", { requestId: request_id });
console.log(result.data);

// 上传文件
const url = await fal.storage.upload(file);</code></pre>
                    </article>
                </div>
            </div>
        </section>

        <!-- Playground -->
        <section id="playgroundPane" class="pane" aria-labelledby="Playground">
            <div class="split">
                <div class="panel left">
                    <div class="panel-header">
                        <h3>输入区</h3>
                        <button class="ghost"><i class="fas fa-sliders"></i> Form</button>
                    </div>
                    <div class="form-block">
                        <label class="req">工作流参数</label>
                        <textarea id="workflowParams" rows="8" placeholder="请输入工作流参数（JSON格式）..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="field">
                            <label>执行模式</label>
                            <select id="execModeSelect">
                                <option value="sync">同步</option>
                                <option value="async">异步</option>
                            </select>
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn" id="resetBtn">重置</button>
                        <button class="btn primary" id="runBtn">运行</button>
                    </div>

                    <section class="price-note">
                        <h4>价格</h4>
                        <p id="priceNote">API调用每次¥0.05元。统一调用平台API接口，无并发限制，无队列限制，消耗钱包。</p>
                    </section>
                </div>
                <div class="panel right">
                    <div class="panel-header">
                        <h3>结果展示区</h3>
                        <div class="right-actions">
                            <button class="ghost"><i class="fas fa-eye"></i> Preview</button>
                        </div>
                    </div>
                    <div class="preview" id="previewBox">
                        <span class="preview-icon"><i class="far fa-image"></i></span>
                    </div>
                    <div class="preview-actions">
                        <button class="ghost"><i class="fas fa-share"></i> Share</button>
                        <button class="ghost"><i class="fas fa-download"></i> Download</button>
                    </div>
                    <details class="logs">
                        <summary>Show logs</summary>
                        <pre id="logBox"></pre>
                    </details>
                </div>
            </div>
        </section>
    </main>

    <!-- API KEY类型及权益对比弹窗 -->
    <div class="modal" id="comparisonModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>API KEY类型及权益对比</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 第一部分：API KEY类型 -->
                <div class="api-types-section">
                    <h4 class="section-title">API KEY 类型</h4>
                    <div class="api-type-cards">
                        <div class="api-type-card card-member">
                            <h5>消费级-会员API</h5>
                            <p>该API适合个人和小团队使用。基础版支持1并发，专业版支持3并发，专业Plus版支持5并发。基于强大的ComfyUI环境，支持7*24小时稳定运行和高效工作流，满足小规模创作需求。</p>
                            <button class="card-btn btn-blue">去开通</button>
                        </div>
                        <div class="api-type-card card-shared">
                            <h5>企业级-共享API</h5>
                            <p>该共享API基于RH公共资源池，提供弹性调用服务，默认并发为50，按实际使用计费。用户可以灵活调用各类工作流，按需扩展调用规模。适合日常业务接入、批量处理、阶段性增长等场景，平衡灵活性与成本效益。</p>
                            <button class="card-btn btn-orange">去充值</button>
                        </div>
                        <div class="api-type-card card-exclusive">
                            <h5>企业级-独占API</h5>
                            <p>该独占API为性能敏感或大规模生产环境提供专用计算资源。通过独立租用GPU算力，用户可以享受固定并发和稳定响应速度。特别适合对高并发、低延迟、稳定性要求严格的核心业务场景。</p>
                            <button class="card-btn btn-orange">去开通</button>
                        </div>
                    </div>
                </div>

                <!-- 第二部分：API KEY权益对比 -->
                <div class="api-comparison-section">
                    <h4 class="section-title">API KEY 权益对比</h4>
                    <div class="comparison-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>类型</th>
                                    <th>消费级-会员API</th>
                                    <th>企业级-共享API</th>
                                    <th>企业级-独占API</th>
                                </tr>
                            </thead>
                            <tbody id="modalComparisonTableBody">
                                <!-- 表格内容由JavaScript根据模型类型动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="api-data.js"></script>
    <script src="standard-models.js"></script>
    <script>
        // 格式化数字
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // 查找工作流
        function findWorkflowByName(name) {
            // 等待数据加载
            if (!window._allApisData || window._allApisData.length === 0) {
                return null;
            }
            
            return window._allApisData.find(api => api.name === name) || null;
        }

        // 加载工作流详情
        function loadWorkflowDetail() {
            const params = new URLSearchParams(window.location.search);
            const workflowName = decodeURIComponent(params.get('name') || '');
            
            if (!workflowName) {
                document.getElementById('modelTitle').textContent = '未找到工作流';
                return;
            }

            // 等待数据加载
            function tryLoad() {
                if (!window._allApisData || window._allApisData.length === 0) {
                    setTimeout(tryLoad, 200);
                    return;
                }

                const workflow = findWorkflowByName(workflowName);
                
                if (!workflow) {
                    document.getElementById('modelTitle').textContent = '未找到工作流';
                    return;
                }

                // 更新页面信息
                document.getElementById('modelTitle').textContent = workflow.name;
                document.getElementById('modelDescription').textContent = workflow.description || '';
                document.getElementById('runCountDisplay').textContent = formatNumber(workflow.runCount || 0);
                document.getElementById('likeCountDisplay').textContent = formatNumber(workflow.likeCount || 0);
                document.getElementById('favoriteCountDisplay').textContent = formatNumber(workflow.favoriteCount || 0);
                document.getElementById('aboutText').textContent = workflow.description || '';
                
                // 确保 thirdPartyTag 的内容正确（防止被其他脚本修改）
                const thirdPartyTagCheck = document.getElementById('thirdPartyTag');
                if (thirdPartyTagCheck && thirdPartyTagCheck.textContent !== '三方模型API') {
                    thirdPartyTagCheck.textContent = '三方模型API';
                }
                const ownModelTagCheck = document.getElementById('ownModelTag');
                if (ownModelTagCheck && ownModelTagCheck.textContent !== '自有模型API') {
                    ownModelTagCheck.textContent = '自有模型API';
                }

                // 判断模型类型
                // 优先使用 modelType 字段：'thirdParty' 表示三方模型API，'own' 或其他值表示自有模型API
                // 如果没有 modelType 字段，则根据来源判断
                let isThirdParty = false;
                
                // 首先检查 modelType 字段（最可靠的方式）
                if (workflow.modelType === 'thirdParty') {
                    isThirdParty = true;
                } else if (workflow.modelType === 'own') {
                    isThirdParty = false;
                } else {
                    // 如果没有 modelType 字段，根据来源判断
                    if (workflow.source && workflow.source.channelName) {
                        const channelName = workflow.source.channelName;
                        // 如果渠道名称是明确的第三方渠道，则判断为三方模型
                        isThirdParty = channelName === '三方' || 
                                      channelName === '第三方' || 
                                      channelName === 'OpenAI' || 
                                      channelName === 'Anthropic';
                        // 如果渠道名称是'官方'，则明确不是三方模型
                        if (channelName === '官方') {
                            isThirdParty = false;
                        }
                    }
                }
                
                // 调试信息（可以在控制台查看）
                console.log('工作流信息:', {
                    name: workflow.name,
                    modelType: workflow.modelType,
                    source: workflow.source,
                    isThirdParty: isThirdParty
                });
                
                // 更新标签显示
                const thirdPartyTag = document.getElementById('thirdPartyTag');
                const ownModelTag = document.getElementById('ownModelTag');
                const bothModelTable = document.getElementById('bothModelTable');
                const ownModelOnlyTable = document.getElementById('ownModelOnlyTable');

                // 确保元素存在
                if (!thirdPartyTag || !ownModelTag || !bothModelTable || !ownModelOnlyTable) {
                    console.error('标签或表格元素未找到:', {
                        thirdPartyTag: !!thirdPartyTag,
                        ownModelTag: !!ownModelTag,
                        bothModelTable: !!bothModelTable,
                        ownModelOnlyTable: !!ownModelOnlyTable
                    });
                    return;
                }

                // 确保标签内容正确（防止被其他脚本修改）
                if (thirdPartyTag.textContent !== '三方模型API') {
                    thirdPartyTag.textContent = '三方模型API';
                }
                if (ownModelTag.textContent !== '自有模型API') {
                    ownModelTag.textContent = '自有模型API';
                }
                
                // 先记录设置前的状态
                console.log('设置前的状态:', {
                    thirdPartyTag_display: window.getComputedStyle(thirdPartyTag).display,
                    thirdPartyTag_style: thirdPartyTag.getAttribute('style'),
                    thirdPartyTag_innerHTML: thirdPartyTag.innerHTML,
                    thirdPartyTag_textContent: thirdPartyTag.textContent
                });
                
                if (isThirdParty) {
                    // 情况1：同时显示"三方模型API"和"自有模型API"两个标签
                    // 确保完全移除可能的内联样式
                    thirdPartyTag.removeAttribute('style');
                    ownModelTag.removeAttribute('style');
                    
                    // 设置显示 - 使用 classList 添加类来确保显示
                    thirdPartyTag.classList.add('show-tag');
                    thirdPartyTag.classList.remove('hide-tag');
                    thirdPartyTag.style.display = 'inline-block';
                    
                    ownModelTag.classList.add('show-tag');
                    ownModelTag.classList.remove('hide-tag');
                    ownModelTag.style.display = 'inline-block';
                    
                    // 显示表格1（同时包含三方API调用费用和运行时长消耗费用）
                    bothModelTable.style.display = 'table';
                    ownModelOnlyTable.style.display = 'none';
                    
                    // 更新价格（如果工作流有价格信息）
                    updateBothModelTablePrices(workflow);
                    
                    // 更新右侧表格内容，使其与弹窗一致
                    updateRightTableForBothModels(workflow);
                    
                    // 更新弹窗表格内容
                    updateModalTableForBothModels(workflow);
                    
                    console.log('已设置标签显示：三方模型API + 自有模型API');
                    
                    // 立即验证设置后的状态
                    setTimeout(() => {
                        const computed = window.getComputedStyle(thirdPartyTag);
                        console.log('设置后的验证:', {
                            display: computed.display,
                            visibility: computed.visibility,
                            opacity: computed.opacity,
                            width: computed.width,
                            height: computed.height,
                            offsetWidth: thirdPartyTag.offsetWidth,
                            offsetHeight: thirdPartyTag.offsetHeight,
                            innerHTML: thirdPartyTag.innerHTML,
                            textContent: thirdPartyTag.textContent,
                            parentElement: thirdPartyTag.parentElement?.tagName,
                            parentDisplay: thirdPartyTag.parentElement ? window.getComputedStyle(thirdPartyTag.parentElement).display : 'N/A',
                            nextSibling: thirdPartyTag.nextElementSibling?.tagName,
                            previousSibling: thirdPartyTag.previousElementSibling?.tagName
                        });
                        
                        // 如果仍然不可见，尝试强制显示
                        if (thirdPartyTag.offsetWidth === 0 || thirdPartyTag.offsetHeight === 0) {
                            console.error('警告：thirdPartyTag 尺寸为0，尝试强制显示');
                            thirdPartyTag.style.cssText = 'display: inline-block !important; visibility: visible !important; opacity: 1 !important;';
                            // 强制重排
                            void thirdPartyTag.offsetHeight;
                        }
                    }, 0);
                } else {
                    // 情况2：只显示"自有模型API"标签
                    thirdPartyTag.classList.add('hide-tag');
                    thirdPartyTag.classList.remove('show-tag');
                    thirdPartyTag.style.display = 'none';
                    
                    ownModelTag.classList.add('show-tag');
                    ownModelTag.classList.remove('hide-tag');
                    ownModelTag.style.display = 'inline-block';
                    
                    // 显示表格2（只包含运行时长消耗费用）
                    bothModelTable.style.display = 'none';
                    ownModelOnlyTable.style.display = 'table';
                    
                    // 更新右侧表格内容，使其与弹窗一致
                    updateRightTableForOwnModelOnly(workflow);
                    
                    // 更新弹窗表格内容
                    updateModalTableForOwnModelOnly(workflow);
                    
                    console.log('已设置标签显示：仅自有模型API');
                }
            }
            
            tryLoad();
        }

        // 更新表格1的价格（三方模型API和自有模型API）
        function updateBothModelTablePrices(workflow) {
            // 这里可以根据实际价格数据更新
            // 暂时使用默认值
            const price1 = document.getElementById('bothThirdPartyPrice1');
            const price2 = document.getElementById('bothThirdPartyPrice2');
            const price3 = document.getElementById('bothThirdPartyPrice3');
            
            // 如果有价格数据，可以在这里更新
            // 暂时保持默认值
        }

        // 更新右侧表格内容（当同时显示三方模型API和自有模型API时）
        function updateRightTableForBothModels(workflow) {
            // 获取右侧表格中的行
            const thirdPartyPriceRow = document.querySelector('#bothModelTable tbody tr:nth-child(1)');
            const runtimeCostRow = document.querySelector('#bothModelTable tbody tr:nth-child(2)');
            const billingModeRow = document.querySelector('#bothModelTable tbody tr:nth-child(3)');
            
            // 根据图片内容更新"三方API调用费用"行
            const price1El = document.getElementById('bothThirdPartyPrice1');
            const price2El = document.getElementById('bothThirdPartyPrice2');
            const price3El = document.getElementById('bothThirdPartyPrice3');
            
            if (price1El && price2El && price3El) {
                // 获取当前价格（如果已设置），否则使用默认值
                // 如果内容已经包含模型名称，尝试提取价格；否则使用原始内容
                let price1 = price1El.textContent.trim();
                let price2 = price2El.textContent.trim();
                let price3 = price3El.textContent.trim();
                
                // 如果内容包含": "，说明已经格式化过，提取价格部分
                if (price1.includes(': ')) {
                    const match = price1.match(/:\s*([^;]+)/);
                    if (match) price1 = match[1].trim();
                }
                if (price2.includes(': ')) {
                    const match = price2.match(/:\s*([^;]+)/);
                    if (match) price2 = match[1].trim();
                }
                if (price3.includes(': ')) {
                    const match = price3.match(/:\s*([^;]+)/);
                    if (match) price3 = match[1].trim();
                }
                
                // 如果没有价格，使用默认值
                if (!price1) price1 = '¥XX/次';
                if (!price2) price2 = '¥XX/次';
                if (!price3) price3 = '¥XX/次';
                
                // 更新为图片格式：Nano-Banana: ¥XX/次; veo3.1-pro: ¥XX/次;
                price1El.innerHTML = `Nano-Banana: ${price1};<br>veo3.1-pro: ${price1};`;
                price2El.innerHTML = `Nano-Banana: ${price2};<br>veo3.2-pro: ${price2};`;
                price3El.innerHTML = `Nano-Banana: ${price3};<br>veo3.3-pro: ${price3};`;
            }
            
            // 更新"运行时长消耗费用"行（与弹窗一致）
            if (runtimeCostRow) {
                const cells = runtimeCostRow.querySelectorAll('td');
                if (cells.length >= 4) {
                    cells[1].innerHTML = '标准任务(24G显存):每秒消耗0.2个RH币;<br>Plus任务(48G显存):每秒消耗0.4个RH币';
                    cells[2].innerHTML = '标准运行(90系列24G)¥4/小时,按秒计费;<br>Plus运行(90系列48G)¥6/小时,按秒计费。<br>注:多并发任务时,成本按累计运行时长计算,不使用不收费';
                    cells[3].innerHTML = '租期内免费';
                }
            }
            
            // 更新"计费模式"行（与弹窗一致）
            if (billingModeRow) {
                const cells = billingModeRow.querySelectorAll('td');
                if (cells.length >= 4) {
                    cells[1].innerHTML = '三方API调用费用,消耗钱包余额;<br>运行时长消耗费用,消耗RH币';
                    cells[2].innerHTML = '三方API调用费用+运行时长消耗费用,消耗钱包余额';
                    cells[3].innerHTML = '三方API调用费用,消耗钱包余额';
                }
            }
        }

        // 更新弹窗表格内容（当同时显示三方模型API和自有模型API时）
        function updateModalTableForBothModels(workflow) {
            const tbody = document.getElementById('modalComparisonTableBody');
            if (!tbody) return;
            
            // 获取价格信息（从右侧表格或API数据）
            const price1El = document.getElementById('bothThirdPartyPrice1');
            const price2El = document.getElementById('bothThirdPartyPrice2');
            const price3El = document.getElementById('bothThirdPartyPrice3');
            
            let price1 = price1El ? price1El.textContent.trim() : '¥XX/次';
            let price2 = price2El ? price2El.textContent.trim() : '¥XX/次';
            let price3 = price3El ? price3El.textContent.trim() : '¥XX/次';
            
            // 如果内容包含": "，说明已经格式化过，提取价格部分
            if (price1.includes(': ')) {
                const match = price1.match(/:\s*([^;]+)/);
                if (match) price1 = match[1].trim();
            }
            if (price2.includes(': ')) {
                const match = price2.match(/:\s*([^;]+)/);
                if (match) price2 = match[1].trim();
            }
            if (price3.includes(': ')) {
                const match = price3.match(/:\s*([^;]+)/);
                if (match) price3 = match[1].trim();
            }
            
            // 如果没有价格，使用默认值
            if (!price1) price1 = '¥XX/次';
            if (!price2) price2 = '¥XX/次';
            if (!price3) price3 = '¥XX/次';
            
            // 根据图片内容生成弹窗表格
            tbody.innerHTML = `
                <tr>
                    <td><strong>适用场景</strong></td>
                    <td>个人或团队内部使用</td>
                    <td>商业化场景灵活调用,按需使用</td>
                    <td>高并发生产、性能敏感场景</td>
                </tr>
                <tr>
                    <td><strong>GPU资源池</strong></td>
                    <td>共享资源池</td>
                    <td>共享资源池</td>
                    <td>独占资源池</td>
                </tr>
                <tr>
                    <td><strong>GPU类型</strong></td>
                    <td>90系列24G/48G</td>
                    <td>90系列24G/48G</td>
                    <td>90系列24G/48G</td>
                </tr>
                <tr>
                    <td><strong>充值模式</strong></td>
                    <td>会员套餐、钱包预充值</td>
                    <td>钱包预充值</td>
                    <td>独占套餐、钱包预充值</td>
                </tr>
                <tr>
                    <td><strong>三方API调用费用</strong></td>
                    <td>Nano-Banana: ${price1};<br>veo3.1-pro: ${price1};</td>
                    <td>Nano-Banana: ${price2};<br>veo3.2-pro: ${price2};</td>
                    <td>Nano-Banana: ${price3};<br>veo3.3-pro: ${price3};</td>
                </tr>
                <tr>
                    <td><strong>运行时长消耗费用</strong></td>
                    <td>标准任务(24G显存):每秒消耗0.2个RH币;<br>Plus任务(48G显存):每秒消耗0.4个RH币</td>
                    <td>标准运行(90系列24G)¥4/小时,按秒计费;<br>Plus运行(90系列48G)¥6/小时,按秒计费。<br>注:多并发任务时,成本按累计运行时长计算,不使用不收费</td>
                    <td>租期内免费</td>
                </tr>
                <tr>
                    <td><strong>计费模式</strong></td>
                    <td>三方API调用费用,消耗钱包余额;<br>运行时长消耗费用,消耗RH币</td>
                    <td>三方API调用费用+运行时长消耗费用,消耗钱包余额</td>
                    <td>三方API调用费用,消耗钱包余额</td>
                </tr>
                <tr>
                    <td><strong>API并发数</strong></td>
                    <td>基础版会员:1;基础版Plus会员:1;专业版会员:3;专业版Plus会员:5</td>
                    <td>默认50,如需扩大并发数请联系:jason@runninghub.ai</td>
                    <td>任务的并发数等同于购买GPU数量</td>
                </tr>
                <tr>
                    <td><strong>高速队列</strong></td>
                    <td>会员高速队列</td>
                    <td>企业级高速队列</td>
                    <td>企业级高速队列</td>
                </tr>
                <tr>
                    <td><strong>主要优势</strong></td>
                    <td>个人使用性价比高</td>
                    <td>弹性灵活的高并发商业化场景</td>
                    <td>独享算力,积累缓存,运行速度快速稳定</td>
                </tr>
                <tr>
                    <td><strong>页面任务权益</strong></td>
                    <td>同会员权益</td>
                    <td>无</td>
                    <td>见独占套餐产品说明</td>
                </tr>
                <tr>
                    <td><strong>并存关系</strong></td>
                    <td>可同时开通共享 API</td>
                    <td>可同时开通会员或独占 API</td>
                    <td>可同时开通共享 API</td>
                </tr>
                <tr>
                    <td><strong>缓存说明</strong></td>
                    <td colspan="3">
                        <div style="line-height: 1.8;">
                            当存在缓存时，任务运行时间将明显缩短。<br><br>
                            共享资源池：任务在资源池中调度，若被调度至不同机器，则可能出现无缓存运行，导致运行时间增加。<br><br>
                            独占资源池：若持续运行同一工作流，将保持缓存状态，一旦切换工作流，缓存会被清理。若希望始终保持缓存运行，目前可通过使用多个账号分别绑定独立工作流来实现。
                        </div>
                    </td>
                </tr>
            `;
        }

        // 更新右侧表格内容（当只显示自有模型API时）
        function updateRightTableForOwnModelOnly(workflow) {
            // 获取右侧表格中的行
            const runtimeCostRow = document.querySelector('#ownModelOnlyTable tbody tr:nth-child(1)');
            const billingModeRow = document.querySelector('#ownModelOnlyTable tbody tr:nth-child(2)');
            const concurrencyRow = document.querySelector('#ownModelOnlyTable tbody tr:nth-child(3)');
            
            // 更新"运行时长消耗费用"行（与弹窗一致）
            if (runtimeCostRow) {
                const cells = runtimeCostRow.querySelectorAll('td');
                if (cells.length >= 4) {
                    cells[1].innerHTML = '标准任务(24G显存):每秒消耗0.2个RH币;<br>Plus任务(48G显存):每秒消耗0.4个RH币';
                    cells[2].innerHTML = '标准运行(90系列24G)¥4/小时,按秒计费;<br>Plus运行(90系列48G)¥6/小时,按秒计费。<br>注:多并发任务时,成本按累计运行时长计算,不使用不收费';
                    cells[3].innerHTML = '租期内免费';
                }
            }
            
            // 更新"计费模式"行（与弹窗一致）
            if (billingModeRow) {
                const cells = billingModeRow.querySelectorAll('td');
                if (cells.length >= 4) {
                    cells[1].innerHTML = '消耗RH币';
                    cells[2].innerHTML = '消耗钱包余额';
                    cells[3].innerHTML = '租期内免费';
                }
            }
            
            // 更新"API并发数"行（与弹窗一致）
            if (concurrencyRow) {
                const cells = concurrencyRow.querySelectorAll('td');
                if (cells.length >= 4) {
                    cells[1].innerHTML = '基础版会员:1;基础版Plus会员:1;专业版会员:3;专业版Plus会员:5';
                    cells[2].innerHTML = '默认50,如需扩大并发数请联系:jason@runninghub.ai';
                    cells[3].innerHTML = '任务的并发数等同于购买GPU数量';
                }
            }
        }

        // 更新弹窗表格内容（当只显示自有模型API时）
        function updateModalTableForOwnModelOnly(workflow) {
            const tbody = document.getElementById('modalComparisonTableBody');
            if (!tbody) return;
            
            // 根据图片内容生成弹窗表格
            tbody.innerHTML = `
                <tr>
                    <td><strong>适用场景</strong></td>
                    <td>个人或团队内部使用</td>
                    <td>商业化场景灵活调用,按需使用</td>
                    <td>高并发生产、性能敏感场景</td>
                </tr>
                <tr>
                    <td><strong>GPU资源池</strong></td>
                    <td>共享资源池</td>
                    <td>共享资源池</td>
                    <td>独占资源池</td>
                </tr>
                <tr>
                    <td><strong>GPU类型</strong></td>
                    <td>90系列24G/48G</td>
                    <td>90系列24G/48G</td>
                    <td>90系列24G/48G</td>
                </tr>
                <tr>
                    <td><strong>充值模式</strong></td>
                    <td>会员套餐、钱包预充值</td>
                    <td>钱包预充值</td>
                    <td>独占套餐、钱包预充值</td>
                </tr>
                <tr>
                    <td><strong>运行时长消耗费用</strong></td>
                    <td>标准任务(24G显存):每秒消耗0.2个RH币;<br>Plus任务(48G显存):每秒消耗0.4个RH币</td>
                    <td>标准运行(90系列24G)¥4/小时,按秒计费;<br>Plus运行(90系列48G)¥6/小时,按秒计费。<br>注:多并发任务时,成本按累计运行时长计算,不使用不收费</td>
                    <td>租期内免费</td>
                </tr>
                <tr>
                    <td><strong>计费模式</strong></td>
                    <td>消耗RH币</td>
                    <td>消耗钱包余额</td>
                    <td>租期内免费</td>
                </tr>
                <tr>
                    <td><strong>API并发数</strong></td>
                    <td>基础版会员:1;基础版Plus会员:1;专业版会员:3;专业版Plus会员:5</td>
                    <td>默认50,如需扩大并发数请联系:jason@runninghub.ai</td>
                    <td>任务的并发数等同于购买GPU数量</td>
                </tr>
                <tr>
                    <td><strong>高速队列</strong></td>
                    <td>会员高速队列</td>
                    <td>企业级高速队列</td>
                    <td>企业级高速队列</td>
                </tr>
                <tr>
                    <td><strong>主要优势</strong></td>
                    <td>个人使用性价比高</td>
                    <td>弹性灵活的高并发商业化场景</td>
                    <td>独享算力,积累缓存,运行速度快速稳定</td>
                </tr>
                <tr>
                    <td><strong>页面任务权益</strong></td>
                    <td>同会员权益</td>
                    <td>无</td>
                    <td>见独占套餐产品说明</td>
                </tr>
                <tr>
                    <td><strong>并存关系</strong></td>
                    <td>可同时开通共享 API</td>
                    <td>可同时开通会员或独占 API</td>
                    <td>可同时开通共享 API</td>
                </tr>
                <tr>
                    <td><strong>缓存说明</strong></td>
                    <td colspan="3">
                        <div style="line-height: 1.8;">
                            当存在缓存时,任务运行时间将明显缩短。<br><br>
                            共享资源池：任务在资源池中调度,若被调度至不同机器,则可能出现无缓存运行,导致运行时间增加。<br><br>
                            独占资源池：若持续运行同一工作流,将保持缓存状态,一旦切换工作流,缓存会被清理。若希望始终保持缓存运行,目前可通过使用多个账号分别绑定独立工作流来实现。
                        </div>
                    </td>
                </tr>
            `;
        }

        // 标签页切换
        function wireTabs() {
            const tabs = document.querySelectorAll('.tab');
            const panes = document.querySelectorAll('.pane');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const linkType = tab.getAttribute('data-link');
                    
                    // 如果有点击链接属性，跳转到新窗口
                    if (linkType) {
                        const params = new URLSearchParams(window.location.search);
                        const workflowName = params.get('name') || '';
                        const workflowId = params.get('id') || '';
                        
                        let url = '';
                        if (linkType === 'playground') {
                            // 跳转到 Playground 页面
                            url = `ai-workflow-playground.html?name=${encodeURIComponent(workflowName)}&id=${encodeURIComponent(workflowId)}`;
                        }
                        
                        if (url) {
                            window.open(url, '_blank');
                        }
                        return;
                    }
                    
                    // 原有的切换逻辑（用于 API 标签）
                    const targetId = tab.getAttribute('data-target');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    panes.forEach(p => p.classList.remove('active'));
                    
                    tab.classList.add('active');
                    if (targetId) {
                        const targetPane = document.querySelector(targetId);
                        if (targetPane) targetPane.classList.add('active');
                    }
                });
            });
        }

        // 复制按钮
        function wireCopyButton() {
            const copyBtn = document.getElementById('copyModelNameBtn');
            const modelTitle = document.getElementById('modelTitle');
            
            if (copyBtn && modelTitle) {
                copyBtn.addEventListener('click', async () => {
                    try {
                        await navigator.clipboard.writeText(modelTitle.textContent);
                        const originalHTML = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                        setTimeout(() => {
                            copyBtn.innerHTML = originalHTML;
                        }, 1000);
                    } catch (err) {
                        console.error('复制失败:', err);
                    }
                });
            }
        }

        // 对比弹窗
        function wireComparisonModal() {
            const comparisonBtn = document.getElementById('comparisonLinkBtn');
            const comparisonModal = document.getElementById('comparisonModal');
            const modalClose = comparisonModal?.querySelector('.modal-close');
            
            if (comparisonBtn && comparisonModal) {
                comparisonBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    comparisonModal.classList.add('show');
                });
            }
            
            if (modalClose && comparisonModal) {
                modalClose.addEventListener('click', function() {
                    comparisonModal.classList.remove('show');
                });
            }
            
            if (comparisonModal) {
                comparisonModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('show');
                    }
                });
            }
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && comparisonModal?.classList.contains('show')) {
                    comparisonModal.classList.remove('show');
                }
            });
        }

        // 下拉菜单
        function addDropdownInteractions() {
            const dropdownBtns = document.querySelectorAll('.dropdown-btn');
            
            dropdownBtns.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const dropdownId = this.getAttribute('data-dropdown');
                    const dropdown = document.getElementById(`${dropdownId}-dropdown`);
                    
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        if (menu !== dropdown) {
                            menu.classList.remove('show');
                        }
                    });
                    
                    if (dropdown) {
                        dropdown.classList.toggle('show');
                    }
                });
            });
            
            document.addEventListener('click', function() {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            });
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadWorkflowDetail();
            wireTabs();
            wireCopyButton();
            wireComparisonModal();
            addDropdownInteractions();
        });
    </script>
</body>
</html>
